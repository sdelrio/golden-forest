<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="The Golden Forest RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="The Golden Forest Atom Feed"><title data-react-helmet="true">Docker build best practices | The Golden Forest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.lorien.cloud/docs/Containers/Docker/docker-build"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Docker build best practices | The Golden Forest"><meta data-react-helmet="true" name="description" content="docker build builds an image from a Dockerfile."><meta data-react-helmet="true" property="og:description" content="docker build builds an image from a Dockerfile."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.lorien.cloud/docs/Containers/Docker/docker-build"><link data-react-helmet="true" rel="alternate" href="https://www.lorien.cloud/docs/Containers/Docker/docker-build" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.lorien.cloud/docs/Containers/Docker/docker-build" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.af61b41b.css">
<link rel="preload" href="/assets/js/runtime~main.35015ae4.js" as="script">
<link rel="preload" href="/assets/js/main.e3aafd9f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">The Golden Forest</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/docs-intro">IT</a><a class="navbar__item navbar__link" docid="tutorial-intro" href="/tutorial/tutorial-intro">Add content</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sdelrio/golden-forest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a tabindex="-1" class="sidebarLogo_FJUI" href="/"><img src="/img/logo.svg" alt="Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Logo" class="themedImage_W2Cr themedImage--dark_oUvU"><b>The Golden Forest</b></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs-intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Backup/borg">Backup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/cloud-infrastructure">Cloud Infrastructure</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cloud Infrastructure&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/cloud-platform">Cloud Platform</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cloud Platform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/coding">Coding</a><button aria-label="Toggle the collapsible sidebar category &#x27;Coding&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/docs/Containers/">Containers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Containers&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/container-registry">Container Registry</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" tabindex="0" href="/docs/Containers/CRI/containerd">CRI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/docs/Containers/Docker/docker-desktop-goodbye">Docker</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/docker-desktop-goodbye">Goodbye Docker Desktop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Containers/Docker/docker-build">Docker build best practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/docker-mac">Docker Desktop for mac</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/docker-multi-platform-build">Docker build multi-platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/docker-rate-limit">Docker Hub Rate Limits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/docker-registry">Docker registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/docker-tag">Docker tag</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/docker-windows">Docker for windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/dockerfile-java">Dockerfile for Java</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/dockerfile-node">Dockerfile for node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Containers/Docker/dockerfile-python">Dockerfile for Python</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/DevOps/">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/Domotic/">Domotic</a><button aria-label="Toggle the collapsible sidebar category &#x27;Domotic&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Hardware/ups">Hardware</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/HomeLab/intel-nuc">HomeLab</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Multimedia/BDSup2Sub">Multimedia</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/Networking/">Networking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Networking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/operative-systems">Operative Systems</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operative Systems&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/category/quality-assurance">Quality Assurance</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quality Assurance&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Security/owasp">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Shell-Script/bash-unit-testing">Shell &amp; Scripts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Software/finances">Software</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Software-Architecture/microservices">Software-Architecture</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Docker build best practices</h1><p><code>docker build</code> builds an image from a Dockerfile.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="dont-run-containers-as-root">Don&#x27;t run containers as root<a class="hash-link" href="#dont-run-containers-as-root" title="Direct link to heading">â€‹</a></h2><p>Even though containers are theoretically isolated, it is not good security practice to run processes as root inside them in the same way as you donâ€™t run your web server as root.</p><p>Towards the end of your build you should add something like</p><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">RUN useradd app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER app</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="dont-use-maintainer">Don&#x27;t use maintainer<a class="hash-link" href="#dont-use-maintainer" title="Direct link to heading">â€‹</a></h2><p><code>MAINTAINER</code> is deprecated. Instead of</p><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">MAINTAINER myfullname (myuser@mydomain.com)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Use <code>LABEL</code>s instead so they can be inspected just like any other metadata.</p><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">LABEL maintainer=&quot;myfullname (myuser@mydomain.com)&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="avoid-env-where-possible">Avoid ENV where possible<a class="hash-link" href="#avoid-env-where-possible" title="Direct link to heading">â€‹</a></h2><p><code>ENV</code> variables remain in the container at run time and pollute its own environment. Use <code>ARG</code>s instead.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="build-with-cache-mount">Build with cache mount<a class="hash-link" href="#build-with-cache-mount" title="Direct link to heading">â€‹</a></h2><p>Speed up your builds by providing a cache for your package manager, ccache, git and so on. This needs to be enabled with DOCKER_CLI_EXPERIMENTAL=enabled</p><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># syntax=docker/dockerfile:experimental</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># FROM and the rest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN --mount=type=cache,target=/var/cache/apt --mount=type=cache,target=/var/lib/apt \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get install -y --no-install-recommends mongodb-server</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="use-ssh-agent">Use SSH agent<a class="hash-link" href="#use-ssh-agent" title="Direct link to heading">â€‹</a></h2><p>If you require SSH credentials for your build donâ€™t copy ~/.ssh because it will stay in the layer even if you remove it later.
Set up SSH agent, and use the experimental feature for ssh mounts</p><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">RUN --mount=type=ssh git clone https://github.com/private_repo/repo.git</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="use-build-secrets">Use build secrets<a class="hash-link" href="#use-build-secrets" title="Direct link to heading">â€‹</a></h2><p>If you need sensitive files that should not be public for your build, use secrets. This way, those files will only be visible to that <code>RUN</code> command during its execution and its contents will disappear without a trace from all layers after that.</p><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">RUN --mount=type=secret,id=signing_key,dst=/tmp/sign.cert signing_command</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="use-onbuild-commands-in-images">Use <code>ONBUILD</code> Commands in Images<a class="hash-link" href="#use-onbuild-commands-in-images" title="Direct link to heading">â€‹</a></h2><p> What this does is it specifies commands which are to be run when a new image is being built from the image with the <code>ONBUILD</code> commands.</p><p>One way to think of it is as a form of inheritance for images and it can be very useful in reducing code duplication up your Dockerfiles. In fact, oftentimes Dockerfiles in your individual projects can be just a single <code>FROM</code> command using your onbuild image. The one caveat to this is that you must have a standard set of build and run commands for all projects of that type.</p><ul><li>Sample:</li></ul><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:8-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONBUILD CMD [&quot;node&quot;, &quot;/app/index.js&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONBUILD COPY package.json /appONBUILD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm set progress=false &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    npm install --silent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONBUILD RUN npm test &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    npm coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONBUILD COPY . /app</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now, say we build an image from the above Dockerfile and tag it as <code>theimage/node:8-onbuild</code> and publish this image.</p><p>Then we can use this image for any Node.js project so long as it has the npm scripts for test and coverage and can be run from the file <code>index.js</code> in the root of the project. The Dockerfile for our projects will be one line:</p><div class="codeBlockContainer_I0IT language-Dockerfile theme-code-block"><div class="codeBlockContent_wNvx Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">FROM theimage/node:8-onbluild</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And all of the logic will live in the shared image.</p><p>It is very beneficial for you and your organization to create and maintain common base images for all types of applications you plan to support and even create onbuild images off of these bases. This provides a good place to make sweeping changes, reduce the amount of code, and simplify your CI pipelines.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="articles">Articles<a class="hash-link" href="#articles" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://ownyourbits.com/2019/05/13/building-docker-containers-in-2019/" target="_blank" rel="noopener noreferrer">Building Docker containers in 2019</a></li><li><a href="https://tech.cars.com/docker-for-continuous-delivery-advanced-topics-and-patterns-7532235998af" target="_blank" rel="noopener noreferrer">2017: Docker for CD: Advanced Topics and Patters</a></li><li><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices" target="_blank" rel="noopener noreferrer">Docker best practices</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/sdelrio/golden-forest/edit/master/docs/Containers/Docker/docker-build.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Containers/Docker/docker-desktop-goodbye"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Goodbye Docker Desktop</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Containers/Docker/docker-mac"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Desktop for mac</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dont-run-containers-as-root" class="table-of-contents__link toc-highlight">Don&#39;t run containers as root</a></li><li><a href="#dont-use-maintainer" class="table-of-contents__link toc-highlight">Don&#39;t use maintainer</a></li><li><a href="#avoid-env-where-possible" class="table-of-contents__link toc-highlight">Avoid ENV where possible</a></li><li><a href="#build-with-cache-mount" class="table-of-contents__link toc-highlight">Build with cache mount</a></li><li><a href="#use-ssh-agent" class="table-of-contents__link toc-highlight">Use SSH agent</a></li><li><a href="#use-build-secrets" class="table-of-contents__link toc-highlight">Use build secrets</a></li><li><a href="#use-onbuild-commands-in-images" class="table-of-contents__link toc-highlight">Use <code>ONBUILD</code> Commands in Images</a></li><li><a href="#articles" class="table-of-contents__link toc-highlight">Articles</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/docs-intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/sdelrio/golden-forest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 The Golden Forest project. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.35015ae4.js"></script>
<script src="/assets/js/main.e3aafd9f.js"></script>
</body>
</html>