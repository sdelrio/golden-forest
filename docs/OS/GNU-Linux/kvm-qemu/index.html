<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="The Golden Forest RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="The Golden Forest Atom Feed"><title data-react-helmet="true">KVM/QEMU | The Golden Forest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.lorien.cloud/docs/OS/GNU-Linux/kvm-qemu"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="KVM/QEMU | The Golden Forest"><meta data-react-helmet="true" name="description" content="KVM UI managers"><meta data-react-helmet="true" property="og:description" content="KVM UI managers"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.lorien.cloud/docs/OS/GNU-Linux/kvm-qemu"><link data-react-helmet="true" rel="alternate" href="https://www.lorien.cloud/docs/OS/GNU-Linux/kvm-qemu" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.lorien.cloud/docs/OS/GNU-Linux/kvm-qemu" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3abcee9f.css">
<link rel="preload" href="/assets/js/runtime~main.f912f43e.js" as="script">
<link rel="preload" href="/assets/js/main.8ab694e0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">The Golden Forest</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/docs-intro">IT</a><a class="navbar__item navbar__link" docid="tutorial-intro" href="/tutorial/tutorial-intro">Add content</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sdelrio/golden-forest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>The Golden Forest</b></a><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs-intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/Backup/restic">Backup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/category/cloud-infrastructure">Cloud Infrastructure</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cloud Infrastructure&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/category/cloud-platform">Cloud Platform</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cloud Platform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/category/coding">Coding</a><button aria-label="Toggle the collapsible sidebar category &#x27;Coding&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/Containers/">Containers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Containers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/DevOps/">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/Domotic/">Domotic</a><button aria-label="Toggle the collapsible sidebar category &#x27;Domotic&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/Hardware/ups">Hardware</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/HomeLab/intel-nuc">HomeLab</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/Multimedia/BDSup2Sub">Multimedia</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/Networking/">Networking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Networking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_2fq0" href="/docs/category/operative-systems">Operative Systems</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operative Systems&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/imaging-tools">Imaging and Cloning tools</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/docs/OS/GNU-Linux/automatic-upgrades">GNU-Linux</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/GNU-Linux/automatic-upgrades">Automatic Upgrades</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/GNU-Linux/clean-system">Clean system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/GNU-Linux/disk-caching-and-performance">Disk Caching &amp; Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/OS/GNU-Linux/kvm-qemu">KVM/QEMU</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/GNU-Linux/netplan">Netplan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/GNU-Linux/resolved">Systemd-resolved</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/GNU-Linux/ssh">ssh client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OS/GNU-Linux/syslog">Syslog</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/OS/GNU-Linux/HDs/smart">HDs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/OS/GNU-Linux/Kernel/linux-5.15">Kernel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/OS/GNU-Linux/Networking/traceroute">Networking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" tabindex="0" href="/docs/OS/GNU-Linux/ZFS/">ZFS</a><button aria-label="Toggle the collapsible sidebar category &#x27;ZFS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/OS/GNU-Linux/Drivers/AMD/radeon">Drivers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/OS/GNU-Linux/Hardware/CPU/Benchmarks/7zip">Hardware</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/OS/Windows/generic-keys">Windows</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_2fq0" href="/docs/category/quality-assurance">Quality Assurance</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quality Assurance&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/Security/owasp">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/Shell-Script/tmux">Shell &amp; Scripts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/Software-Architeture/streaming">Software-Architeture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/Software/Backup/duplicati">Software</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>KVM/QEMU</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="kvm-ui-managers">KVM UI managers<a class="hash-link" href="#kvm-ui-managers" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://github.com/kimchi-project/kimchi/" target="_blank" rel="noopener noreferrer">Kimchi: HTML5 management interface</a></li><li><a href="https://virt-manager.org/" target="_blank" rel="noopener noreferrer">vir-manager: desktop app availabe in most distributions</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="qemuconf">qemu.conf<a class="hash-link" href="#qemuconf" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="uefi-bios">UEFI BIOS<a class="hash-link" href="#uefi-bios" title="Direct link to heading">â€‹</a></h3><p>To enable UEFI bios override (VGA passwthrough and others). Uncomment the <code>nvram</code> config.</p><ul><li><code>/etc/libvirt/qemu.conf</code></li></ul><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># Later, when libvirt creates per domain variable store, this list is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># searched for the master image. The UEFI firmware can be called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># differently for different guest architectures. For instance, it&#x27;s OVMF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># for x86_64 and i686, but it&#x27;s AAVMF for aarch64. The libvirt default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># follows this scheme.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvram = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;/usr/share/OVMF/OVMF_CODE.fd:/usr/share/OVMF/OVMF_VARS.fd&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;/usr/share/OVMF/OVMF_CODE.secboot.fd:/usr/share/OVMF/OVMF_VARS.fd&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;/usr/share/AAVMF/AAVMF_CODE.fd:/usr/share/AAVMF/AAVMF_VARS.fd&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;/usr/share/AAVMF/AAVMF32_CODE.fd:/usr/share/AAVMF/AAVMF32_VARS.fd&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;/usr/share/OVMF/OVMF_CODE.ms.fd:/usr/share/OVMF/OVMF_VARS.ms.fd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="disable-security">Disable security<a class="hash-link" href="#disable-security" title="Direct link to heading">â€‹</a></h4><p>Set <code>security_driver = &quot;none&quot;</code> if you need some special privilege, like VGA or USB passthrough.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="console">Console<a class="hash-link" href="#console" title="Direct link to heading">â€‹</a></h4><ul><li>Enter into a folder and boot efi manually:</li></ul><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">FS1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd EFI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bootx64.efi</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Set manually a boot file on startup:</li></ul><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">echo \EFI\boot\bootx64.efi &gt; \startup.nsh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="virtio-win-isos">virtio-win isos<a class="hash-link" href="#virtio-win-isos" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/" target="_blank" rel="noopener noreferrer">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="virtio-fs">virtio-fs<a class="hash-link" href="#virtio-fs" title="Direct link to heading">â€‹</a></h2><p>Virtiofs is a shared file system that lets virtual machines access a directory tree on the host. Unlike existing approaches, it is designed to offer local file system semantics and performance.</p><ul><li><a href="https://virtio-fs.gitlab.io/" target="_blank" rel="noopener noreferrer">https://virtio-fs.gitlab.io/</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="requirements">Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">â€‹</a></h3><ul><li>Linux 5.4</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">uname</span><span class="token plain"> -rv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5.4</span><span class="token plain">.0-90-generic </span><span class="token comment" style="color:#999988;font-style:italic">#101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>QEMU 5.0</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ qemu-aarch64_be-static --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qemu-aarch64_be version </span><span class="token number" style="color:#36acaa">5.0</span><span class="token plain">.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Debian </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">:5.0-5ubuntu6~ppa0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2003</span><span class="token plain">-2020 Fabrice Bellard and the QEMU Project developers</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>libvirt 6.2+ (in my case i got 6.6.0)</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ libvirtd -V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libvirtd </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">libvirt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6.6</span><span class="token plain">.0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>memory_backend_dir</code> enabled on libvirt.conf</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> memory_backing_dir /etc/libvirt/qemu.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">memory_backing_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/var/lib/libvirt/qemu/ram&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="ubuntu-2004">Ubuntu 20.04<a class="hash-link" href="#ubuntu-2004" title="Direct link to heading">â€‹</a></h4><p>QEMU 5.0, libvirt 6.6, virtmanager 3.0, are available for Ubuntu 20.04:</p><ul><li><a href="https://launchpad.net/~jacob/+archive/ubuntu/virtualisation?field.series_filter=focal" target="_blank" rel="noopener noreferrer">https://launchpad.net/~jacob/+archive/ubuntu/virtualisation?field.series_filter=focal</a></li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="cli-install">CLI install<a class="hash-link" href="#cli-install" title="Direct link to heading">â€‹</a></h5><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> add-apt-repository ppa:jacob/virtualisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="ansible-install">Ansible install<a class="hash-link" href="#ansible-install" title="Direct link to heading">â€‹</a></h5><div class="codeBlockContainer_K1bP language-yaml theme-code-block"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Add Jacob Zimmermann APT repo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apt_repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ppa</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">jacob/virtualisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codename</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> focal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;APT VM packages&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> qemu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kvm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> qemu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libvirt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">daemon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libvirt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">clients</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> virt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ovmf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> libhugetlbfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bin      </span><span class="token comment" style="color:#999988;font-style:italic"># hugeadm: Tools to ease use of hugetlbfs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="cpu-section-with-numa">CPU section with NUMA<a class="hash-link" href="#cpu-section-with-numa" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">cpu</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">host-model</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">check</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">none</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">topology</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">sockets</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">dies</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cores</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">6</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">threads</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">2</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">numa</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">cell</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpus</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0-11</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">memory</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">16</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">unit</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">GiB</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">memAccess</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">shared</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">numa</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">cpu</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="memorybacking-with-source-and-access">memoryBacking with source and access<a class="hash-link" href="#memorybacking-with-source-and-access" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">memoryBacking</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">hugepages</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">source</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">memfd</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">access</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">shared</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">memoryBacking</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="filesystem-with-virtiofs">filesystem with virtiofs<a class="hash-link" href="#filesystem-with-virtiofs" title="Direct link to heading">â€‹</a></h3><ul><li>source dir will be a path on the hots machine</li><li>target dir is the name of the mounted drive in the guest machine</li></ul><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">devices</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">filesystem</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">mount</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">accessmode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">passthrough</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">driver</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">virtiofs</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">queue</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1024</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">source</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">dir</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/hddpool/imagenes</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">target</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">dir</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">mount_tag</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">filesystem</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">devices</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="install-virtiofs-drivers-on-windows">Install virtiofs drivers on windows<a class="hash-link" href="#install-virtiofs-drivers-on-windows" title="Direct link to heading">â€‹</a></h3><ul><li><a href="https://virtio-fs.gitlab.io/howto-windows.html" target="_blank" rel="noopener noreferrer">How to install virtiofs drivers on windows</a></li></ul><ol><li>Install <a href="http://www.secfs.net/winfsp" target="_blank" rel="noopener noreferrer">WinFsp</a></li><li>Install virtiofs PCI device driver: Device manager, right click Mass storage device, use virtio-win ISO to install drivers</li><li>Copy <code>E:\viofs\w10\amd64</code> (E drive is your virtio-win ISO drivers) to a local location (sample <code>C:\virtiofs</code>).</li><li>Install virtio service on windows (open terminal as administrator).</li></ol><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">sc.exe create VirtioFsSvc binpath=&quot;C:\virtiofs\virtiofs.exe&quot; start=auto depend=&quot;WinFsp.Launcher/VirtioFsDrv&quot; DisplayName=&quot;Virtio FS Service&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="6"><li>Start VirtioFsSvc (open terminal as administrator).</li></ol><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">sc.exe start VirtioFsSvc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img alt="virtiofs terminal" src="/assets/images/virtiofs-start-svc-728a7bd1aaca1d96f37bb239d62673de.png"></p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="pci-passthrough">PCI passthrough<a class="hash-link" href="#pci-passthrough" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="check-if-is-amd_iommuon--amd_iommupt-enabled">Check if is <code>amd_iommu=on</code> &amp; <code>amd_iommu=pt</code> enabled<a class="hash-link" href="#check-if-is-amd_iommuon--amd_iommupt-enabled" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">dmesg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> AMD-Vi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.498933</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> pci 0000:00:00.2: AMD-Vi: IOMMU performance counters supported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.503260</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> pci 0000:00:00.2: AMD-Vi: Found IOMMU cap 0x40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.503261</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> pci 0000:00:00.2: AMD-Vi: Extended features </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x58f77ef22294ade</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.503263</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> AMD-Vi: Interrupt remapping enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.503263</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> AMD-Vi: Virtual APIC enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.503263</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> AMD-Vi: X2APIC enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.503333</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> AMD-Vi: Lazy IO/TLB flushing enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.801913</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> AMD-Vi: AMD IOMMUv2 driver by Joerg Roedel </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">jroedel@suse.de</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ lspci </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> VGA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:00.0 VGA compatible controller: Advanced Micro Devices, Inc. </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AMD/ATI</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Ellesmere </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Radeon RX </span><span class="token number" style="color:#36acaa">470</span><span class="token plain">/480/570/570X/580/580X/590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rev cf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ lspci </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> VGA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:00.0 VGA compatible controller: Advanced Micro Devices, Inc. </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AMD/ATI</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Ellesmere </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Radeon RX </span><span class="token number" style="color:#36acaa">470</span><span class="token plain">/480/570/570X/580/580X/590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rev cf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ lspci -nn</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> 09:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:00.0 VGA compatible controller </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0300</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Advanced Micro Devices, Inc. </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AMD/ATI</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Ellesmere </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Radeon RX </span><span class="token number" style="color:#36acaa">470</span><span class="token plain">/480/570/570X/580/580X/590</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1002</span><span class="token plain">:67df</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rev cf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:00.1 Audio de</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>VGA has two devices, the first one is the graphics card and the second is the hdmi audio. In some graphics cards are even 3 of them (like usb or serial port). If you going to do a PCI passthrough to a VM you have to pass all the PCI IDs from that card.</p><ul><li><a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF" target="_blank" rel="noopener noreferrer">ArchLinux PCI passthrough via OVMF</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="vga-passthrough">VGA Passthrough<a class="hash-link" href="#vga-passthrough" title="Direct link to heading">â€‹</a></h3><ul><li>start.sh</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Helpful to read output when debugging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hoock start.sh&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /tmp/delete.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Stop display manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop display-manager.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Uncomment the following line if you use GDM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#killall gdm-x-session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Unbind VTconsoles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /sys/devices/virtual/vtconsole/vtcon0/bind</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/class/vtconsole/vtcon0/bind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/devices/virtual/vtconsole/vtcon1/bind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If have a 2ndn vga:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#echo 0 &gt; /sys/class/vtconsole/vtcon1/bind</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Unbind EFI-Framebuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#echo efi-framebuffer.0 &gt; /sys/bus/platform/drivers/efi-framebuffer/unbind || true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Avoid a Race condition by waiting 2 seconds. This can be calibrated to be shorter or longer if required for your system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Unload all Nvidia drivers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe -r nvidia_drm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe -r nvidia_modeset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe -r nvidia_uvm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe -r nvidia</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Unload 2nd VGA AMDGPU driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#DEVS=&quot;0000_0a_00_0 0000_0a_00_1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#for DEV in $DEVS; do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  echo -n &quot;$DEV -&gt; &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  virsh nodedev-detach pci_${DEV} || ( sleep 1 ; virsh nodedev-detach pci_${DEV} )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sleep 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Unbind the GPU from display driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#virsh nodedev-detach pci_0000_09_00_0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#virsh nodedev-detach pci_0000_09_00_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DEVS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0000_09_00_0 0000_09_00_1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">DEV</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$DEVS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$DEV</span><span class="token string" style="color:#e3116c"> -&gt; &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> nodedev-detach pci_</span><span class="token variable" style="color:#36acaa">${DEV}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> nodedev-detach pci_</span><span class="token variable" style="color:#36acaa">${DEV}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Unload AMD GPU driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -r amdgpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Load VFIO Kernel Module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe vfio-pci</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>revert.sh</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;revert.sh&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /tmp/deleteme.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Unload VFIO-PCI Kernel Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -r vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -r vfio_iommu_type1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe -r vfio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Re-Bind GPU to Nvidia Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#virsh nodedev-reattach pci_0000_0c_00_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#virsh nodedev-reattach pci_0000_0c_00_0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Re-Bind GPU to AMDGPU Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#virsh nodedev-reattach pci_0000_09_00_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#virsh nodedev-reattach pci_0000_09_00_0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DEVS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0000_09_00_1 0000_09_00_0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">DEV</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$DEVS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$DEV</span><span class="token string" style="color:#e3116c"> -&gt; &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> nodedev-reattach pci_</span><span class="token variable" style="color:#36acaa">${DEV}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$DEV</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/bus/pci/devices/</span><span class="token variable" style="color:#36acaa">$DEV</span><span class="token plain">/driver/unbind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$DEV</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/bus/pci/drivers/vfio-pci/unbind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Re-Bind AMDGPU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#DEVS=&quot;0000_0a_00_0 0000_0a_00_1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#for DEV in $DEVS; do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  echo -n &quot;$DEV -&gt; &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  virsh nodedev-reattach pci_${DEV}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sleep 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Rebind VT consoles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/class/vtconsole/vtcon0/bind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Some machines might have more than 1 virtual console. Add a line for each corresponding VTConsole</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#echo 1 &gt; /sys/class/vtconsole/vtcon1/bind</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/devices/virtual/vtconsole/vtcon1/bind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#nvidia-xconfig --query-gpu-info &gt; /dev/null 2&gt;&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe nvidia_drm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe nvidia_modeset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe nvidia_uvm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#modprobe nvidia</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sleep as test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe amdgpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#echo &quot;efi-framebuffer.0&quot; &gt; /sys/bus/platform/drivers/efi-framebuffer/bind</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Restart Display Manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#systemctl start display-manager.service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start display-manager.service</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><a href="https://github.com/sdelrio/ansible-workstation/blob/master/roles/kvm/templates/hooks/amd/prepare/begin/start.sh" target="_blank" rel="noopener noreferrer">My prepare start.sh VM for VGA passthrough</a></li><li><a href="https://github.com/sdelrio/ansible-workstation/blob/master/roles/kvm/templates/hooks/amd/release/end/revert.sh" target="_blank" rel="noopener noreferrer">My release revert VM for VGA passthrough</a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">â€‹</a></h4><ul><li><a href="https://www.reddit.com/r/VFIO/comments/hy2enj/how_to_keep_2nd_passthrough_graphics_card/" target="_blank" rel="noopener noreferrer">How to keep 2nd passthrough graphics card</a></li><li><a href="https://www.reddit.com/r/VFIO/comments/73og2w/cant_get_amdgpu_driver_to_stop_grabbing_2nd_gpu/" target="_blank" rel="noopener noreferrer">AMD GPU driver to stop grabbinb 2nd GPU</a></li><li><a href="https://mathiashueber.com/windows-virtual-machine-gpu-passthrough-ubuntu/" target="_blank" rel="noopener noreferrer">Beginner friendly guide to VM with GPU passtrhough on Ubuntu 18</a></li><li><a href="https://github.com/joeknock90/Single-GPU-Passthrough" target="_blank" rel="noopener noreferrer">GitHub: joeknock90 - Single GPU Passthrough on Linux</a></li><li><a href="https://www.techpowerup.com/vgabios/?architecture=AMD&amp;manufacturer=MSI&amp;model=RX+470&amp;version=015.050.000.000.000000&amp;interface=&amp;memType=&amp;memSize=&amp;since=" target="_blank" rel="noopener noreferrer">Video RX470 BIOS Collection</a></li><li><a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#UEFI_(OVMF)_compatibility_in_VBIOS" target="_blank" rel="noopener noreferrer">UEFI (OVMF) compatibility in VBIOS</a></li><li><a href="https://www.reddit.com/r/VFIO/comments/c93kqs/cannot_unbind_guest_gpu_from_amdgpu_driver/" target="_blank" rel="noopener noreferrer">Reddit: Cannot unbind guest GPU from amdgpu driver</a></li><li><a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF" target="_blank" rel="noopener noreferrer">PCI passwthrough via OVMF</a></li><li><a href="https://forum.level1techs.com/t/vfio-in-2019-pop-os-how-to-general-guide-though-draft/142287" target="_blank" rel="noopener noreferrer">VFIO in 2019 â€“ Pop!_OS How-To (General Guide though)</a></li><li><a href="https://bytee.net/blog/kvm-gpu-pass-through-with-identical-cards" target="_blank" rel="noopener noreferrer">Linux KVM GPU pass-through with identical graphic cards</a></li><li><a href="http://vfio.blogspot.com/2015/05/vfio-gpu-how-to-series-part-3-host.htmlo" target="_blank" rel="noopener noreferrer">VFIO GPU How To series, part 3 - Host configuration</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="remove-the-device-and-rescan-pcie-bus">Remove the device and rescan PCIe bus<a class="hash-link" href="#remove-the-device-and-rescan-pcie-bus" title="Direct link to heading">â€‹</a></h3><p>Removing the PCIe device via the remove function in its directory and reloading it via the PCIe bus&#x27; rescan function causes the kernel to power-cycle the PCIe device without rebooting your computer.</p><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/bus/pci/devices/DDDD</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">:BB</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">:DD.F/remove</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/bus/pci/rescan</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the above code, <code>DDDD:BB:DD.F</code> is the device slot format Domain:Bus:Device.Function.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>AMD VGA</h5></div><div class="admonition-content"><p>On some Radeon cards, it can&#x27;t be rebooted</p></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="references-1">References<a class="hash-link" href="#references-1" title="Direct link to heading">â€‹</a></h4><ul><li><a href="https://unix.stackexchange.com/questions/73908/how-to-reset-cycle-power-to-a-pcie-device/245184#245184" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/questions/73908/how-to-reset-cycle-power-to-a-pcie-device/245184#245184</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="list-vfio">List VFIO<a class="hash-link" href="#list-vfio" title="Direct link to heading">â€‹</a></h3><ul><li>vfio-list.sh</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DEVS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0000:0a:00.0 0000:0a:00.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">DEV</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$DEVS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  echo &quot;vfio-pci&quot; &gt; &quot;/sys/bus/pci/devices/$DEV/driver_override&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/sys/bus/pci/devices/</span><span class="token string variable" style="color:#36acaa">$DEV</span><span class="token string" style="color:#e3116c">/driver_override&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  echo $DEV &gt; &quot;/sys/bus/pci/devices/$DEV/driver/unbind&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sudo virsh nodedev-detach pci_0000_0a_00_0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sudo virsh nodedev-detach pci_0000_0a_00_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> modprobe amdgpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">DEV</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$DEVS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lscpi -s </span><span class="token variable" style="color:#36acaa">$DEV</span><span class="token plain"> -v </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># kernel driver used on pcie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">DEV</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$DEVS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lscpi -s </span><span class="token variable" style="color:#36acaa">$DEV</span><span class="token plain"> -nnk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="list-iommu-groups">List IOMMU groups<a class="hash-link" href="#list-iommu-groups" title="Direct link to heading">â€‹</a></h3><ul><li><code>ls-iommu.sh</code></li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">d</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> /sys/kernel/iommu_groups/*/devices/*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">n</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${d</span><span class="token variable operator" style="color:#393A34">#</span><span class="token variable" style="color:#36acaa">*</span><span class="token variable operator" style="color:#393A34">/</span><span class="token variable" style="color:#36acaa">iommu_groups</span><span class="token variable operator" style="color:#393A34">/</span><span class="token variable" style="color:#36acaa">*}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">n</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${n</span><span class="token variable operator" style="color:#393A34">%%</span><span class="token variable operator" style="color:#393A34">/</span><span class="token variable" style="color:#36acaa">*}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;IOMMU Group %s &#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lspci -nns </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${d</span><span class="token string variable operator" style="color:#393A34">##</span><span class="token string variable" style="color:#36acaa">*</span><span class="token string variable operator" style="color:#393A34">/</span><span class="token string variable" style="color:#36acaa">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="poweroff-discrete-graphis">Poweroff discrete graphis<a class="hash-link" href="#poweroff-discrete-graphis" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">powerdown vga powersave</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><a href="https://askubuntu.com/questions/771562/16-04-power-off-discrete-graphics-ati-amd" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/771562/16-04-power-off-discrete-graphics-ati-amd</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="vga">VGA<a class="hash-link" href="#vga" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="recomendations">Recomendations<a class="hash-link" href="#recomendations" title="Direct link to heading">â€‹</a></h3><p>For the desktop use case (assuming display performance matters and/or you need multihead support), in order of preference:</p><ol><li><code>virtio</code> vga or <code>virtio-gpu-pci</code>, if your guest has drivers</li><li><code>qxl</code> vga, if your guest has drivers.</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If guest is windows, is recomended to this enable change resolution when you resize the spice window and enable copy/paste from/to VM, so make sure you do this:</p><ul><li>Install <a href="https://www.spice-space.org/download/windows/spice-guest-tools/spice-guest-tools-latest.exe" target="_blank" rel="noopener noreferrer">spice-guest-tools</a> .</li><li>Install spice VD agent.</li></ul><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> spice-vdagent</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Make sure that in the qemu xml you have a ve the spicevmc channel into the <code>&lt;devices&gt;...&lt;/devices&gt;</code> section.</li></ul><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">channel</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">spicevmc</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">target</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">virtio</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">com.redhat.spice.0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">state</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">disconnected</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">alias</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">channel0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">address</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">virtio-serial</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">controller</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">bus</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">port</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">channel</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><ol start="3"><li><code>bochs</code> display device, when using UEFI</li><li><code>std</code>, standard VGA</li></ol><p>For the server use case (assuming the GUI is rarely used, or not at all), in order of preference:</p><ol><li><code>none</code>: serial console, if you can work without a GUI</li><li><code>bochs</code> display device, when using UEFI</li><li><code>std</code>, standard VGA</li></ol><p>On arm systems display devices with a pci memory bar do not work, which reduces the choices alot. We are left with:</p><ol><li><code>virtio-gpu-pci</code> virtio gpu, if your guest has drivers</li><li><code>ramfb</code></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="references-2">References<a class="hash-link" href="#references-2" title="Direct link to heading">â€‹</a></h3><ul><li><a href="https://www.kraxel.org/blog/2019/09/display-devices-in-qemu/" target="_blank" rel="noopener noreferrer">VGA and other display devices in qemu</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="pci-passthrough-1">PCI passthrough<a class="hash-link" href="#pci-passthrough-1" title="Direct link to heading">â€‹</a></h2><p>Usually very complex and recomended only for advanced users.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="usb-hotplug">USB hotplug<a class="hash-link" href="#usb-hotplug" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="attach-a-usb-device">Attach a USB device<a class="hash-link" href="#attach-a-usb-device" title="Direct link to heading">â€‹</a></h3><p>Attach your device to your VM using virtmanager. You will end up with a section like this in your machine definition:</p><ol><li>Copy this snippets to a new file <code>/etc/libvirt/snippets/SNIPPET.xml</code></li></ol><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">hostdev</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">subsystem</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">usb</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">managed</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">yes</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vendor</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">0x04f9</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">product</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">0x2015</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">address</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">usb</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">bus</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">port</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">4</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">hostdev</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>Load the snippet into the Virtual Machine:</li></ol><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> attach-device VMNAME /etc/libvirt/snippets/SNIPPET.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device attached successfully</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li><p>Find <code>ENV{PRODUCT}</code> using <code>udevadm monitor --environment</code></p></li><li><p>Add a <code>/etc/udev/rules.d/90-libvirt-usb.rules</code> to automate this plugin and unpluggin using <code>udev</code>.</p></li></ol><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ACTION==&quot;add&quot;,    SUBSYSTEM==&quot;usb&quot;, ENV{PRODUCT}==&quot;4f9/2015/100&quot;, RUN+=&quot;/usr/bin/virsh attach-device VMNAME /etc/libvirt/snippets/SNIPPET.xml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ACTION==&quot;remove&quot;, SUBSYSTEM==&quot;usb&quot;, ENV{PRODUCT}==&quot;4f9/2015/100&quot;, RUN+=&quot;/usr/bin/virsh detach-device VMNAME /etc/libvirt/snippets/SNIPPET.xml&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="references-3">References<a class="hash-link" href="#references-3" title="Direct link to heading">â€‹</a></h4><ul><li><a href="https://blog.tinyhost.de/blog/2020-05-01_libvirt_usb.html" target="_blank" rel="noopener noreferrer">2020: Hotplug USB devices into libvirt VMS</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="huge-pages">Huge Pages<a class="hash-link" href="#huge-pages" title="Direct link to heading">â€‹</a></h2><p>HugePages is a feature integrated into the Linux kernel since v2.6. It makes possible for the OS to suport memory pages greater than the default (usually 4KB). Using very large page sizes can improve system performance by reduccing the ammount of system resources required to access page tables entries.. I&#x27;t size vary from 2MB to 256oMB, depending on the kernel version and the harware architecture.
This feature is commonly enabled in VMs and big Databases.</p><p>For KVM/libvirt case I put a hugepages scripts on <code>/etc/libvirt/hooks/hugepages.sh</code> and then make symbolic links from each libvirtvm hook to that one. For.</p><p>Example, if you have 2 VMs named <code>wind10</code> and <code>ubuntu20</code>:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/libvirt/hooks/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  huepages.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  qemu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  qemu.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    win10/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prepare/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hugepages.sh -&gt; ../../../../hugepages.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      release/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hugepages.sh -&gt; ../../../../hugepages.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ubuntu20/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prepare/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hugepages.sh -&gt; ../../../../hugepages.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      release/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hugepages.sh -&gt; ../../../../hugepages.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="get-current-hugepages">Get current Hugepages<a class="hash-link" href="#get-current-hugepages" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> Huge /proc/meminfo</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="references-4">References<a class="hash-link" href="#references-4" title="Direct link to heading">â€‹</a></h3><ul><li><a href="https://github.com/sdelrio/ansible-workstation/blob/master/roles/kvm/files/hooks/hugepages.sh" target="_blank" rel="noopener noreferrer">My hugepages hook script</a></li><li><a href="https://passthroughpo.st/simple-per-vm-libvirt-hooks-with-the-vfio-tools-hook-helper/" target="_blank" rel="noopener noreferrer">Howto: Libvirt Automation Using VFIO-Tools Hook Helper</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="isolate-cpus-using-kernes-cgroup-cpuset">Isolate CPUs using kerne&#x27;s cgroup cpuset<a class="hash-link" href="#isolate-cpus-using-kernes-cgroup-cpuset" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://github.com/PassthroughPOST/VFIO-Tools/blob/master/libvirt_hooks/hooks/cset.sh" target="_blank" rel="noopener noreferrer">hooks: Add cset CPU isolation hook</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="windonws-10-vm">Windonws 10 VM<a class="hash-link" href="#windonws-10-vm" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://www.heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough/" target="_blank" rel="noopener noreferrer">09/2021: Running Windows 10 on Linux using KVM wiht VGA passthrough</a></li><li><a href="https://www.heiko-sieger.info/creating-a-windows-10-vm-on-the-amd-ryzen-9-3900x-using-qemu-4-0-and-vga-passthrough/" target="_blank" rel="noopener noreferrer">10/2021: Windows 10 KVM VN on Ryzen 9 3900x using qemu and vga passthrough</a></li><li><a href="https://superuser.com/questions/1057959/windows-10-in-kvm-change-boot-disk-to-virtio/1200899#1200899" target="_blank" rel="noopener noreferrer">2017: Windows 10 in KVM: change boot disk to Virtio</a></li><li><a href="https://github.com/mattshortland/windows-virt-toolkit" target="_blank" rel="noopener noreferrer">Windows virt toolkit</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="osx-vm">OSX VM<a class="hash-link" href="#osx-vm" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://github.com/foxlet/macOS-Simple-KVM" target="_blank" rel="noopener noreferrer">Tools to set up a quick macOS VM in QEMU, accelerated by KVM</a></li><li><a href="https://computingforgeeks.com/how-to-run-macos-on-kvm-qemu/" target="_blank" rel="noopener noreferrer">How to run macOS on KVM/QEMU</a></li><li><a href="https://github.com/SpaceinvaderOne/Macinabox/blob/master/unraid.sh" target="_blank" rel="noopener noreferrer">Unraid Mac in a Box</a></li><li><a href="https://www.youtube.com/watch?v=EtVa_Y7gkxc" target="_blank" rel="noopener noreferrer">2020: Video - Easy Opencore macOS big sur on ryzen</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="gaming-vm">Gaming VM<a class="hash-link" href="#gaming-vm" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://rokups.github.io/#!pages/gaming-vm-performance.md" target="_blank" rel="noopener noreferrer">Performance of your gaming VM</a></li><li><a href="https://mathiashueber.com/performance-tweaks-gaming-on-virtual-machines/" target="_blank" rel="noopener noreferrer">2021: Guide to performance optimizations for gaming on VM with QEMU and PCI passthrough</a></li><li><a href="https://mathiashueber.com/pci-passthrough-ubuntu-2004-virtual-machine/" target="_blank" rel="noopener noreferrer">2020: VM with PCI passthrough on Ubuntu 20.04 for gaming machine</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="cpu-pinning">CPU Pinning<a class="hash-link" href="#cpu-pinning" title="Direct link to heading">â€‹</a></h2><p>CPU-pinning will allocate CPU-cores for the guest VM while it is running. The idea is the host machine not using the guest CPU cores pinned inside the VM.</p><p>A more agresive aproach could be to use <code>isolcpus</code> kernel command line as linux boot parameter to restrict access even if the VM is not running.</p><details class="details_2Ziz alert alert--info details_1VDD" data-collapsed="true"><summary>isolcpu kernel parameters</summary><div><div class="collapsibleContent_3OHp"><div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#With_isolcpus_kernel_parameter" target="_blank" rel="noopener noreferrer">https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#With_isolcpus_kernel_parameter</a></p><p>Example, let us assume you are using CPUs 4-7. Use the kernel parameters <code>isolcpus nohz_full rcu_nocbs</code> to completely isolate the CPUs from the kernel. For example:</p><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">isolcpus</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">-7 </span><span class="token assign-left variable" style="color:#36acaa">nohz_full</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">-7 </span><span class="token assign-left variable" style="color:#36acaa">rcu_nocbs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">-7</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, run <code>qemu-system-x86_64</code> with taskset and chrt:</p><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">chrt -r </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> taskset -c </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">-7 qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>chrt</code> command will ensure that the task scheduler will round-robin distribute work (otherwise it will all stay on the first cpu). For taskset, the CPU numbers can be comma- and/or dash-separated, like &quot;0,1,2,3&quot; or &quot;0-4&quot; or &quot;1,7-8,10&quot; etc.</p></div></div></div></div></div></details><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="amd-ryzen-3900">AMD Ryzen 3900<a class="hash-link" href="#amd-ryzen-3900" title="Direct link to heading">â€‹</a></h3><p><img alt="cpu-ryzen3k" src="/assets/images/lstopo-cpu-ryzen3900-c6901e8dae8bf06aef70a1a0f164664b.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Screnshot from lstopo cli tool</h5></div><div class="admonition-content"><p>Tool to see CPU architecture, usually in all mayor distributions.</p><ul><li>Ubuntu/Mint: <code>apt-get install hwloc</code></li></ul></div></div><p>AMD Ryzen 3900 has 12 physical cores, each core with 2 threads, with a total of 24 cores availabe to make the cpu pinning.</p><p>The 12 cores are spared in 4 complex of 3 physical cores called CCX.</p><p>Each CCX has his own L3 (16MB) cache.</p><p>Depending on the power needed inside the VM we could set:</p><ul><li>1 CCX for the host and 3 CCX for the VM</li><li>2 CCX for the host and 2 CCX for the VM</li><li>...</li><li><code>n</code> CCX for the hots and <code>4-n</code> CCX for the VM</li></ul><p>In this example will choose 2 for the host and 2 for the VM:</p><p><img alt="pin cpu ryen3900" src="/assets/images/lstopo-pin-cpu-ryzen3900-24ea067bf50b290a9090480994b1ae37.png"></p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="manual-edit-your-vm-xml">Manual edit your VM xml<a class="hash-link" href="#manual-edit-your-vm-xml" title="Direct link to heading">â€‹</a></h4><p>Edit your VM xml settings wiht <code>virsh edit your-windows-vm-name</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="domain-schema">Domain schema<a class="hash-link" href="#domain-schema" title="Direct link to heading">â€‹</a></h4><p>Search for</p><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">domain</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">kvm</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and repace with:</p><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">domain</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">kvm</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">qemu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">http://libvirt.org/schemas/domain/qemu/1.0</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="update-vcpu-section">Update vcpu section<a class="hash-link" href="#update-vcpu-section" title="Direct link to heading">â€‹</a></h4><p>Find line within <code>&lt;vcpu&gt;....&lt;/vcpu&gt;</code> and add the following block:</p><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpu</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">placement</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">static</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">12</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">vcpu</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">iothreads</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">iothreads</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">cputune</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">12</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">13</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">2</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">14</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">3</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">15</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">4</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">16</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">5</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">17</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">6</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">18</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">7</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">19</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">8</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">20</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">9</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">21</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">10</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">22</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">vcpupin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">vcpu</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">11</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">23</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">emulatorpin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">0-1</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">iothreadpin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">iothread</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">0-1</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">iothreadpin</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">iothread</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">2</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cpuset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">2-3</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">cputune</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="update-cpu-section">Update cpu section<a class="hash-link" href="#update-cpu-section" title="Direct link to heading">â€‹</a></h4><p>Find the block <code>&lt;cpu&gt;...&lt;/cpu&gt;</code> and adapt like this:</p><div class="codeBlockContainer_K1bP language-xml theme-code-block"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">cpu</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">host-passthrough</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">check</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">none</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">topology</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">sockets</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cores</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">6</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">threads</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">2</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">cache</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">passthrough</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">feature</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">policy</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">require</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">topoext</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- add additional cpu features here--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">cpu</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="wakeonlan">WakeonLan<a class="hash-link" href="#wakeonlan" title="Direct link to heading">â€‹</a></h2><p>libvirt-wakenlan, a daemon which listens for wake on LAN packets and starts libvirt based virtual machines</p><ul><li><a href="https://github.com/simoncadman/libvirt-wakeonlan" target="_blank" rel="noopener noreferrer">GitHub libvirt-wakeonlan</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="apparmor">Apparmor<a class="hash-link" href="#apparmor" title="Direct link to heading">â€‹</a></h2><p>When you find some vm not sarting, check for dmesg or <code>/var/log/syslog</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="libvirt-denied-capname-sysrawio">libvirt denied capname <code>sysrawio</code><a class="hash-link" href="#libvirt-denied-capname-sysrawio" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP language-log theme-code-block"><div class="codeBlockContent_hGly log"><pre tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">[ 2592.816582] audit: type=1400 audit(1638036341.363:33): apparmor=&quot;DENIED&quot; operation=&quot;capable&quot; profile=&quot;libvirtd&quot; pid=4545 comm=&quot;prio-rpc-worker&quot; capability=17  capname=&quot;sys_rawio&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 2593.030984] audit: type=1400 audit(1638036341.575:34): apparmor=&quot;DENIED&quot; operation=&quot;capable&quot; profile=&quot;libvirtd&quot; pid=47974 comm=&quot;libvirt_parthel&quot; capability=17  capname=&quot;sys_rawio&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 2593.045133] audit: type=1400 audit(1638036341.591:35): apparmor=&quot;DENIED&quot; operation=&quot;capable&quot; profile=&quot;libvirtd&quot; pid=47977 comm=&quot;libvirt_parthel&quot; capability=17  capname=&quot;sys_rawio&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Edit apparmor and add <code>capability sys_rawio,</code> (the comma at the end too) and restart libvirt service</p><div class="codeBlockContainer_K1bP language-bash theme-code-block"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/apparmor.d/abstractions/libvirt-qemu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart libvirtd</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/sdelrio/golden-forest/edit/master/docs/OS/GNU-Linux/kvm-qemu.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/OS/GNU-Linux/disk-caching-and-performance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Disk Caching &amp; Performance</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/OS/GNU-Linux/netplan"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Netplan</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#kvm-ui-managers" class="table-of-contents__link toc-highlight">KVM UI managers</a></li><li><a href="#qemuconf" class="table-of-contents__link toc-highlight">qemu.conf</a><ul><li><a href="#uefi-bios" class="table-of-contents__link toc-highlight">UEFI BIOS</a></li></ul></li><li><a href="#virtio-win-isos" class="table-of-contents__link toc-highlight">virtio-win isos</a></li><li><a href="#virtio-fs" class="table-of-contents__link toc-highlight">virtio-fs</a><ul><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#cpu-section-with-numa" class="table-of-contents__link toc-highlight">CPU section with NUMA</a></li><li><a href="#memorybacking-with-source-and-access" class="table-of-contents__link toc-highlight">memoryBacking with source and access</a></li><li><a href="#filesystem-with-virtiofs" class="table-of-contents__link toc-highlight">filesystem with virtiofs</a></li><li><a href="#install-virtiofs-drivers-on-windows" class="table-of-contents__link toc-highlight">Install virtiofs drivers on windows</a></li></ul></li><li><a href="#pci-passthrough" class="table-of-contents__link toc-highlight">PCI passthrough</a><ul><li><a href="#check-if-is-amd_iommuon--amd_iommupt-enabled" class="table-of-contents__link toc-highlight">Check if is <code>amd_iommu=on</code> &amp; <code>amd_iommu=pt</code> enabled</a></li><li><a href="#vga-passthrough" class="table-of-contents__link toc-highlight">VGA Passthrough</a></li><li><a href="#remove-the-device-and-rescan-pcie-bus" class="table-of-contents__link toc-highlight">Remove the device and rescan PCIe bus</a></li><li><a href="#list-vfio" class="table-of-contents__link toc-highlight">List VFIO</a></li><li><a href="#list-iommu-groups" class="table-of-contents__link toc-highlight">List IOMMU groups</a></li><li><a href="#poweroff-discrete-graphis" class="table-of-contents__link toc-highlight">Poweroff discrete graphis</a></li></ul></li><li><a href="#vga" class="table-of-contents__link toc-highlight">VGA</a><ul><li><a href="#recomendations" class="table-of-contents__link toc-highlight">Recomendations</a></li><li><a href="#references-2" class="table-of-contents__link toc-highlight">References</a></li></ul></li><li><a href="#pci-passthrough-1" class="table-of-contents__link toc-highlight">PCI passthrough</a></li><li><a href="#usb-hotplug" class="table-of-contents__link toc-highlight">USB hotplug</a><ul><li><a href="#attach-a-usb-device" class="table-of-contents__link toc-highlight">Attach a USB device</a></li></ul></li><li><a href="#huge-pages" class="table-of-contents__link toc-highlight">Huge Pages</a><ul><li><a href="#get-current-hugepages" class="table-of-contents__link toc-highlight">Get current Hugepages</a></li><li><a href="#references-4" class="table-of-contents__link toc-highlight">References</a></li></ul></li><li><a href="#isolate-cpus-using-kernes-cgroup-cpuset" class="table-of-contents__link toc-highlight">Isolate CPUs using kerne&#39;s cgroup cpuset</a></li><li><a href="#windonws-10-vm" class="table-of-contents__link toc-highlight">Windonws 10 VM</a></li><li><a href="#osx-vm" class="table-of-contents__link toc-highlight">OSX VM</a></li><li><a href="#gaming-vm" class="table-of-contents__link toc-highlight">Gaming VM</a></li><li><a href="#cpu-pinning" class="table-of-contents__link toc-highlight">CPU Pinning</a><ul><li><a href="#amd-ryzen-3900" class="table-of-contents__link toc-highlight">AMD Ryzen 3900</a></li></ul></li><li><a href="#wakeonlan" class="table-of-contents__link toc-highlight">WakeonLan</a></li><li><a href="#apparmor" class="table-of-contents__link toc-highlight">Apparmor</a><ul><li><a href="#libvirt-denied-capname-sysrawio" class="table-of-contents__link toc-highlight">libvirt denied capname <code>sysrawio</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/docs-intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/sdelrio/golden-forest" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 The Golden Forest proyect. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f912f43e.js"></script>
<script src="/assets/js/main.8ab694e0.js"></script>
</body>
</html>