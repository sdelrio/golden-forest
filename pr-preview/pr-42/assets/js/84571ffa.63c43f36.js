"use strict";(self.webpackChunkgolden_forest_website=self.webpackChunkgolden_forest_website||[]).push([["1650"],{7654:function(e,t,n){n.r(t),n.d(t,{default:()=>h,frontMatter:()=>s,metadata:()=>r,assets:()=>c,toc:()=>d,contentTitle:()=>o});var r=JSON.parse('{"id":"OS/GNU-Linux/disk-caching-and-performance","title":"Disk Caching & Performance","description":"Get vm.dirtyratio & vm.dirtybackground_ratio","source":"@site/docs/OS/GNU-Linux/disk-caching-and-performance.md","sourceDirName":"OS/GNU-Linux","slug":"/OS/GNU-Linux/disk-caching-and-performance","permalink":"/pr-preview/pr-42/docs/OS/GNU-Linux/disk-caching-and-performance","draft":false,"unlisted":false,"editUrl":"https://github.com/sdelrio/golden-forest/edit/master/docs/OS/GNU-Linux/disk-caching-and-performance.md","tags":[{"inline":true,"label":"vm.dirty_ratio","permalink":"/pr-preview/pr-42/docs/tags/vm-dirty-ratio"},{"inline":true,"label":"vm.dirty_background_ratio","permalink":"/pr-preview/pr-42/docs/tags/vm-dirty-background-ratio"}],"version":"current","frontMatter":{"tags":["vm.dirty_ratio","vm.dirty_background_ratio"]},"sidebar":"tutorialSidebar","previous":{"title":"Clean system","permalink":"/pr-preview/pr-42/docs/OS/GNU-Linux/clean-system"},"next":{"title":"Netplan","permalink":"/pr-preview/pr-42/docs/OS/GNU-Linux/netplan"}}'),i=n("85893"),a=n("50065");let s={tags:["vm.dirty_ratio","vm.dirty_background_ratio"]},o="Disk Caching & Performance",c={},d=[{value:"Get vm.dirty_ratio &amp; vm.dirty_background_ratio",id:"get-vmdirty_ratio--vmdirty_background_ratio",level:2},{value:"Ansible",id:"ansible",level:2},{value:"Referenes",id:"referenes",level:2}];function l(e){let t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"disk-caching--performance",children:"Disk Caching & Performance"})}),"\n",(0,i.jsx)(t.h2,{id:"get-vmdirty_ratio--vmdirty_background_ratio",children:"Get vm.dirty_ratio & vm.dirty_background_ratio"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"$ sysctl -a | grep dirty\n vm.dirty_background_ratio = 10\n vm.dirty_background_bytes = 0\n vm.dirty_ratio = 20\n vm.dirty_bytes = 0\n vm.dirty_writeback_centisecs = 500\n vm.dirty_expire_centisecs = 3000\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"watch grep -A 1 dirty /proc/vmstat\nnr_dirty 2\nnr_writeback 0\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If these numbers are significantly higher you might be having a bigger problem on your system.  Though from what I have read this sometimes indicates sync\u2019ing.  If this becomes a problem on your server you can set system parameters in ",(0,i.jsx)(t.code,{children:"/etc/sysctl.conf"})," to head this off by adding the following lines:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"vm.dirty_background_ratio = 50\nvm.dirty_ratio = 80\n"})}),"\n",(0,i.jsx)(t.p,{children:"Then (as root) execute:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"# sysctl -p\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"vm.dirty_background_ratio"})," tells at what ratio should the linux kernel start the background task of writing out dirty pages. The above increases this setting from the default 10% to 50%.  The ",(0,i.jsx)(t.code,{children:"vm.dirty_ratio"})," tells at what ratio all IO writes become synchronous, meaning that we cannot do IO calls without waiting for the underlying device to complete them (which is something you never want to happen)."]}),"\n",(0,i.jsxs)(t.p,{children:["I did not add these to the ",(0,i.jsx)(t.code,{children:"sysctl.conf"})," file but thought it worth documenting."]}),"\n",(0,i.jsx)(t.h2,{id:"ansible",children:"Ansible"}),"\n",(0,i.jsx)(t.p,{children:"Sample task"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'- name: Tune dirty sysctl\n  hosts: all\n  become: true\n\n  tasks:\n\n    sysctl:\n        name: "{{ item.key }}"\n        value: "{{ item.value }}"\n        state: present\n        reload: yes\n      with_items:\n        - { key: vm.swappiness, value: 1 }\n        - { key: vm.min_free_kbytes, value: 131072 }\n        - { key: vm.dirty_background_ratio, value: 1 } # https://www.vertica.com/kb/Tuning-Linux-Dirty-Data-Parameters-for-Vertica/Content/BestPractices/Tuning-Linux-Dirty-Data-Parameters-for-Vertica.htm#ForMoreInformation\n        - { key: vm.dirty_ratio, value: 3 } # https://lonesysadmin.net/2013/12/22/better-linux-disk-caching-performance-vm-dirty_ratio/\n'})}),"\n",(0,i.jsx)(t.h2,{id:"referenes",children:"Referenes"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://superuser.com/questions/1057007/adjust-linux-disk-flush-intervals-to-avoid-blocking-user-processes",children:"2016: Adjust linux disk flush intervals to avoid blocking user processes"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://lonesysadmin.net/2013/12/22/better-linux-disk-caching-performance-vm-dirty_ratio/",children:"2013:\nBetter Linux Disk Caching & Performance with vm.dirty_ratio & vm.dirty_background_ratio"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://linux.uits.uconn.edu/2013/08/06/flush-this-2/#",children:"2013: Flush this"})}),"\n"]})]})}function h(e={}){let{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},50065:function(e,t,n){n.d(t,{Z:function(){return o},a:function(){return s}});var r=n(67294);let i={},a=r.createContext(i);function s(e){let t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);