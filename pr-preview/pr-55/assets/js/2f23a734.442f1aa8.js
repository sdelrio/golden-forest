"use strict";(self.webpackChunkgolden_forest_website=self.webpackChunkgolden_forest_website||[]).push([["3136"],{14101:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>o,toc:()=>d,default:()=>p,metadata:()=>a,assets:()=>i,contentTitle:()=>l});var a=JSON.parse('{"id":"OS-and-Hardware/OS/GNU-Linux/TrueNAS/truenas-install","title":"TrueNAS SCALE Install","description":"By default Truenas will install in one (or several disk if want to mirror) using all space available on the disk, without posibility for partition.","source":"@site/docs/OS-and-Hardware/OS/GNU-Linux/TrueNAS/truenas-install.md","sourceDirName":"OS-and-Hardware/OS/GNU-Linux/TrueNAS","slug":"/OS-and-Hardware/OS/GNU-Linux/TrueNAS/truenas-install","permalink":"/pr-preview/pr-55/docs/OS-and-Hardware/OS/GNU-Linux/TrueNAS/truenas-install","draft":false,"unlisted":false,"editUrl":"https://github.com/sdelrio/golden-forest/edit/master/docs/OS-and-Hardware/OS/GNU-Linux/TrueNAS/truenas-install.md","tags":[{"inline":true,"label":"zfs","permalink":"/pr-preview/pr-55/docs/tags/zfs"},{"inline":true,"label":"zpool","permalink":"/pr-preview/pr-55/docs/tags/zpool"},{"inline":true,"label":"nas","permalink":"/pr-preview/pr-55/docs/tags/nas"}],"version":"current","frontMatter":{"title":"TrueNAS SCALE Install","date":20230901,"author":"sdelrio","tags":["zfs","zpool","nas"]},"sidebar":"tutorialSidebar","previous":{"title":"TrueNAS","permalink":"/pr-preview/pr-55/docs/OS-and-Hardware/OS/GNU-Linux/TrueNAS/"},"next":{"title":"TrueNAS SCALE scripts","permalink":"/pr-preview/pr-55/docs/OS-and-Hardware/OS/GNU-Linux/TrueNAS/truenas-scripts"}}'),s=r(74848),t=r(84429);let o={title:"TrueNAS SCALE Install",date:0x134b2f5,author:"sdelrio",tags:["zfs","zpool","nas"]},l="TrueNAS SCALE Install",i={},d=[{value:"Using a smaller partition for the root pool",id:"using-a-smaller-partition-for-the-root-pool",level:2},{value:"Use the free space to create a ZVOL",id:"use-the-free-space-to-create-a-zvol",level:3},{value:"References",id:"references",level:3}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"truenas-scale-install",children:"TrueNAS SCALE Install"})}),"\n",(0,s.jsx)(n.p,{children:"By default Truenas will install in one (or several disk if want to mirror) using all space available on the disk, without posibility for partition."}),"\n",(0,s.jsx)(n.h2,{id:"using-a-smaller-partition-for-the-root-pool",children:"Using a smaller partition for the root pool"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Install on a small temporary disk (sda in this case)."}),"\n",(0,s.jsx)(n.li,{children:"Copy partitions from temporary disk to target disk (nvme2n1 in this case):"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sgdisk --backup=/root/partition_table_sda /dev/sda\nsgdisk --load-backup=/root/partition_table_sda /dev/nvme2n1\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Then Reboot the system through the UI or by CLI"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"reboot\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Attach target disk parition to temporary install disk partition, as if you were preparing a mirror"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"zpool attach boot-pool sda3 nvme2n1p3\nzpool status boot-pool\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Wait for resilver"}),"\n",(0,s.jsx)(n.li,{children:"Copy the content of the grub and UEFI partitions"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dd if=/dev/sda1 of=/dev/nvme2n1p1\ndd if=/dev/sda2 of=/dev/nvme2n1p2\nsync\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Detach temporary install disk (sda in this example)"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"zpool offline boot-pool sda\nzpool detach boot-pool sda\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"root@truenas[~]# zpool status boot-pool\n\n  pool: boot-pool\n state: ONLINE\nstatus: Some supported and requested features are not enabled on the pool.\n	The pool can still be used, but some features are unavailable.\naction: Enable all features using 'zpool upgrade'. Once this is done,\n	the pool may no longer be accessible by software that does not support\n	the features. See zpool-features(7) for details.\n  scan: scrub repaired 0B in 00:00:04 with 0 errors on Tue Aug 29 03:45:05 2023\nconfig:\n\n	NAME         STATE     READ WRITE CKSUM\n	boot-pool    ONLINE       0     0     0\n	  nvme2n1p3  ONLINE       0     0     0\n\nerrors: No known data errors\n"})}),"\n",(0,s.jsx)(n.h3,{id:"use-the-free-space-to-create-a-zvol",children:"Use the free space to create a ZVOL"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Check partition with ",(0,s.jsx)(n.code,{children:"parted"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"(parted) print free                                                       \nModel: Samsung SSD 980 500GB (nvme)\nDisk /dev/nvme2n1: 500GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name  Flags\n        17.4kB  2097kB  2080kB  Free Space\n 1      2097kB  3146kB  1049kB                     bios_grub, legacy_boot\n 2      3146kB  540MB   537MB   fat32              boot, esp\n 3      540MB   40.0GB  39.5GB  zfs\n        40.0GB  500GB   460GB   Free Space\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Make new partition. You could use 100% but I like this unit to last a little longer so I leave a 5% free space. So I end partition at 470GB insteadl 500GB."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"(parted) mkpart                                                           \nPartition name?  []?                                                      \nFile system type?  [ext2]? zfs                                            \nStart? 40.0GB                                                             \nEnd? 470GB                                                                \n(parted) p                                                                \nModel: Samsung SSD 980 500GB (nvme)\nDisk /dev/nvme2n1: 500GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name  Flags\n 1      2097kB  3146kB  1049kB                     bios_grub, legacy_boot\n 2      3146kB  540MB   537MB   fat32              boot, esp\n 3      540MB   40.0GB  39.5GB  zfs\n 4      40.0GB  470GB   430GB   zfs\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create a zpool with extra space"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"zpool create boot-extra  /dev/disk/by-id/nvme-Samsung_SSD_980_500GB_S64AAA0T012345B-part4\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Export the poool so TrueNAS can import it"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"zpool export boot-extra\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["In TrueNAS UI ",(0,s.jsx)(n.code,{children:"Storage"})," -> ",(0,s.jsx)(n.code,{children:"Import Pool"})," -> select pool to import pool: ",(0,s.jsx)(n.code,{children:"boot-extra"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.truenas.com/community/threads/howto-setup-a-pair-of-larger-ssds-for-boot-pool-and-data.81409/",children:"https://www.truenas.com/community/threads/howto-setup-a-pair-of-larger-ssds-for-boot-pool-and-data.81409/"})}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},84429:function(e,n,r){r.d(n,{R:()=>o,x:()=>l});var a=r(96540);let s={},t=a.createContext(s);function o(e){let n=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);