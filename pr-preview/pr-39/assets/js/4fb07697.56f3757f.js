"use strict";(self.webpackChunkgolden_forest_website=self.webpackChunkgolden_forest_website||[]).push([["2246"],{86232:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>l,assets:()=>r,toc:()=>d,contentTitle:()=>a});var l=JSON.parse('{"id":"DevOps/DevEnv/dev-env","title":"Nix + devbox + direnv","description":"Managing Dev Envs | S01 E20","source":"@site/docs/DevOps/DevEnv/dev-env.md","sourceDirName":"DevOps/DevEnv","slug":"/DevOps/DevEnv/dev-env","permalink":"/pr-preview/pr-39/docs/DevOps/DevEnv/dev-env","draft":false,"unlisted":false,"editUrl":"https://github.com/sdelrio/golden-forest/edit/master/docs/DevOps/DevEnv/dev-env.md","tags":[{"inline":true,"label":"visual studio code","permalink":"/pr-preview/pr-39/docs/tags/visual-studio-code"},{"inline":true,"label":"nix","permalink":"/pr-preview/pr-39/docs/tags/nix"},{"inline":true,"label":"devbox","permalink":"/pr-preview/pr-39/docs/tags/devbox"},{"inline":true,"label":"direnv","permalink":"/pr-preview/pr-39/docs/tags/direnv"}],"version":"current","frontMatter":{"title":"Nix + devbox + direnv","date":20230713,"tags":["visual studio code","nix","devbox","direnv"]},"sidebar":"tutorialSidebar","previous":{"title":"VM base images","permalink":"/pr-preview/pr-39/docs/DevOps/CI/vm-images"},"next":{"title":"Ansible","permalink":"/pr-preview/pr-39/docs/DevOps/Infra as Code/ansible"}}'),s=i("85893"),t=i("50065");let o={title:"Nix + devbox + direnv",date:0x134b239,tags:["visual studio code","nix","devbox","direnv"]},a="Dev Environment with Nix, Devbox and Direnv",r={},d=[{value:"Managing Dev Envs | S01 E20",id:"managing-dev-envs--s01-e20",level:2},{value:"Sample app",id:"sample-app",level:2},{value:"Global",id:"global",level:2},{value:"Fleek",id:"fleek",level:2}];function c(e){let n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"dev-environment-with-nix-devbox-and-direnv",children:"Dev Environment with Nix, Devbox and Direnv"})}),"\n",(0,s.jsx)(n.h2,{id:"managing-dev-envs--s01-e20",children:(0,s.jsx)(n.a,{href:"https://community.aws/livestreams/build-on-weekly/2023-06-01",children:"Managing Dev Envs | S01 E20"})}),"\n",(0,s.jsx)("iframe",{src:"https://player.twitch.tv/?video=1835498649&parent=localhost&parent=www.lorien.cloud&autoplay=false",title:"Twitch video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:"true",scrolling:"no",height:"378",width:"620"}),"\n",(0,s.jsx)(n.p,{children:"Portable dev environment using 4 open source tools:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/DeterminateSystems/nix-installer",children:(0,s.jsx)(n.code,{children:"nix"})}),". Configuration as code, it comes from ",(0,s.jsx)(n.a,{href:"https://nixos.org",children:"NixOS"}),". Focus on reproducibility\nIf you switch laptops, or if you do things on different machines, it carries along your dev environment with you and make it works everywhere."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"!/bin/bash\n\ncurl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | sh -s -- install\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://www.jetpack.io/devbox/",children:(0,s.jsx)(n.code,{children:"devbox"})}),". Similar to pyenv, you go into a diretory install Go and you get it, you go outside that directory and Go is gone. It saves the config in a json file."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n\ncurl -fsSL https://get.jetpack.io/devbox | bash\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://direnv.net/",children:(0,s.jsx)(n.code,{children:"direnv"})}),". When you enter a directory it looks for a ",(0,s.jsx)(n.code,{children:".envrc"})," file and sources that into your shell."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\n#!/bin/bash\n\nsudo apt update && sudo apt install -y direnv\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"bashrc"}),". Source direnv to automatically hook into the shell and look for that ",(0,s.jsx)(n.code,{children:".envrc"})," file and then change my environment."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n\necho 'eval \"$(direnv hook bash)\"' >> .bashrc\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://gist.github.com/bketelsen/e1646d2a4551217b4f0531fb9f0f3c9a",children:"gist from the article"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"sample-app",children:"Sample app"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/gohugoio/hugo\ncd hugo\ndevbox init\ndevbox add go@latest\n# .devbox/ directory will get the go installation\ndevbox generate direnv\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["install ",(0,s.jsx)(n.code,{children:"direnv"})," extention on Visual Studio Code (the one with the folder logo with a green leaf).\nReloads all the VS stuff to find all the tools installed. For example, you try to install go rich language support in VSCode, and you will get a message ",(0,s.jsx)(n.em,{children:"\"The 'gopls' command is not available. Run 'go install -v golang.org/x/tools/gopls@latest\" to install\""}),", but we will install lit with debox\nInstead of install"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"devbox add gopls@latest\nwhich gopls\nwhich go\ndirenv allow\ncd ..\nwhich go  # go not found \ncd -\nwhich go  # go found again\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now the extension is reloaded and the environment is reloaded because VSCode detected a change on the devbox config file."}),"\n",(0,s.jsx)(n.h2,{id:"global",children:"Global"}),"\n",(0,s.jsx)(n.p,{children:"devbox recently added an update wich does global environments. To use as a global package manage, like Homebrew or apt in Ubuntu."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd $HOME\nwich go  # go not found\ndevbox global pull https://devbox.getfleek.dev/high\n"})}),"\n",(0,s.jsx)(n.p,{children:"It will download a small go application wich will return a json file with a bunch of tools, in this sample case url:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"git"}),"\n",(0,s.jsx)(n.li,{children:"htop"}),"\n",(0,s.jsx)(n.li,{children:"github-cli"}),"\n",(0,s.jsx)(n.li,{children:"glab"}),"\n",(0,s.jsx)(n.li,{children:"fzf"}),"\n",(0,s.jsx)(n.li,{children:"ripgrep"}),"\n",(0,s.jsx)(n.li,{children:"vscode"}),"\n",(0,s.jsx)(n.li,{children:"lazygit"}),"\n",(0,s.jsx)(n.li,{children:"jq"}),"\n",(0,s.jsx)(n.li,{children:"yq"}),"\n",(0,s.jsx)(n.li,{children:"neovim (astro install with scripts, later)"}),"\n",(0,s.jsx)(n.li,{children:"neofetch"}),"\n",(0,s.jsx)(n.li,{children:"btop"}),"\n",(0,s.jsx)(n.li,{children:"cheat"}),"\n",(0,s.jsx)(n.li,{children:"tree-sitter"}),"\n",(0,s.jsx)(n.li,{children:"nodejs"}),"\n",(0,s.jsx)(n.li,{children:"python3Full"}),"\n",(0,s.jsx)(n.li,{children:"exa"}),"\n",(0,s.jsx)(n.li,{children:"bat"}),"\n",(0,s.jsx)(n.li,{children:"atuin"}),"\n",(0,s.jsx)(n.li,{children:"zoxide"}),"\n",(0,s.jsx)(n.li,{children:"direnv"}),"\n",(0,s.jsx)(n.li,{children:"starship"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Also in theh devbox.json you could add, in ",(0,s.jsx)(n.code,{children:"init_hook"})," scripts, a neovim config download."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ devbox global run\nAvailable scripts:\n* install-astro\n* install-hook-bash\n* install-hook-zsh\n* install-starship-prompt\n* latest-hash\n* npm-global\n"})}),"\n",(0,s.jsx)(n.p,{children:"Run a pair of init hooks:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ devbox global run install-hook-bash\n$ cat ~/.bashrc | tail  # at the end an 'eval \"$(devbox global shelenv --init-hook)' was added by the init_hook script\n\n$ devbox global run install-astro\n$ exit  # to create a new bash and test \n"})}),"\n",(0,s.jsx)(n.p,{children:"Now we will see a pretty big prompt, we will use another hook to make it simpler:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ devbox global run install-starship-prompt\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Global config is stored in ",(0,s.jsx)(n.code,{children:"~/devbox/global/current"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"fleek",children:"Fleek"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://getfleek.dev/",children:"Fleek homepage"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Similar to previous solution but seems designed to manage the ",(0,s.jsx)(n.code,{children:"$HOME"})," directory"]})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},50065:function(e,n,i){i.d(n,{Z:function(){return a},a:function(){return o}});var l=i(67294);let s={},t=l.createContext(s);function o(e){let n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);