"use strict";(self.webpackChunkgolden_forest_website=self.webpackChunkgolden_forest_website||[]).push([["1369"],{1166:function(e,i,n){n.r(i),n.d(i,{default:()=>u,frontMatter:()=>s,metadata:()=>t,assets:()=>d,toc:()=>c,contentTitle:()=>a});var t=JSON.parse('{"id":"OS/GNU-Linux/Hardware/CPU/Tuning/disable-cpu-mitigations","title":"Disable mitigations","description":"There is anumber of kernel boot parameters available to disable or fine-tune hardware vulnerability mitigations:","source":"@site/docs/OS/GNU-Linux/Hardware/CPU/Tuning/disable-cpu-mitigations.md","sourceDirName":"OS/GNU-Linux/Hardware/CPU/Tuning","slug":"/OS/GNU-Linux/Hardware/CPU/Tuning/disable-cpu-mitigations","permalink":"/pr-preview/pr-39/docs/OS/GNU-Linux/Hardware/CPU/Tuning/disable-cpu-mitigations","draft":false,"unlisted":false,"editUrl":"https://github.com/sdelrio/golden-forest/edit/master/docs/OS/GNU-Linux/Hardware/CPU/Tuning/disable-cpu-mitigations.md","tags":[{"inline":true,"label":"cpu","permalink":"/pr-preview/pr-39/docs/tags/cpu"},{"inline":true,"label":"tuning","permalink":"/pr-preview/pr-39/docs/tags/tuning"},{"inline":true,"label":"mitigation","permalink":"/pr-preview/pr-39/docs/tags/mitigation"},{"inline":true,"label":"security","permalink":"/pr-preview/pr-39/docs/tags/security"}],"version":"current","frontMatter":{"title":"Disable mitigations","date":20211106,"author":"sdelrio","tags":["cpu","tuning","mitigation","security"]},"sidebar":"tutorialSidebar","previous":{"title":"Temperature","permalink":"/pr-preview/pr-39/docs/OS/GNU-Linux/Hardware/CPU/Monitoring/cpu-temperature"},"next":{"title":"Ram speed","permalink":"/pr-preview/pr-39/docs/OS/GNU-Linux/Hardware/Memory/Checks/linux-ram-speed"}}'),r=n("85893"),l=n("50065");let s={title:"Disable mitigations",date:0x13465a2,author:"sdelrio",tags:["cpu","tuning","mitigation","security"]},a="Disable CPU mitigations",d={},c=[{value:"Hardware vulnerabilities",id:"hardware-vulnerabilities",level:2},{value:"Spectre v1 and v2",id:"spectre-v1-and-v2",level:3},{value:"SSB",id:"ssb",level:3},{value:"L1TF",id:"l1tf",level:3},{value:"MDS",id:"mds",level:3},{value:"TAA",id:"taa",level:3},{value:"iTLB multihit",id:"itlb-multihit",level:3},{value:"KPTI can be disabled with",id:"kpti-can-be-disabled-with",level:3},{value:"TSX async abort",id:"tsx-async-abort",level:3},{value:"KVM NX huge pages",id:"kvm-nx-huge-pages",level:3},{value:"meta-parameter, mitigations",id:"meta-parameter-mitigations",level:2},{value:"Sample Ryzen 3000 series",id:"sample-ryzen-3000-series",level:2},{value:"Edit grub CMDLINE",id:"edit-grub-cmdline",level:3},{value:"Update grub and restart",id:"update-grub-and-restart",level:3},{value:"References",id:"references",level:2}];function o(e){let i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"disable-cpu-mitigations",children:"Disable CPU mitigations"})}),"\n",(0,r.jsx)(i.p,{children:"There is anumber of kernel boot parameters available to disable or fine-tune hardware vulnerability mitigations:"}),"\n",(0,r.jsx)(i.h2,{id:"hardware-vulnerabilities",children:"Hardware vulnerabilities"}),"\n",(0,r.jsx)(i.h3,{id:"spectre-v1-and-v2",children:"Spectre v1 and v2"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"nospectre_v1"})," (x86, PowerPC),"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"nospectre_v2"})," (x86, PowerPC, S/390, ARM64),"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"spectre_v2_user=off"})," (x86)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"ssb",children:"SSB"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"spec_store_bypass_disable=off"})," (x86, PowerPC)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"ssbd=force-off"})," (ARM64)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"l1tf",children:"L1TF"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"l1tf=off"})," (x86)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"mds",children:"MDS"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"mds=off"})," (x86)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"taa",children:"TAA"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.code,{children:"tsx_async_abort=off"})}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"itlb-multihit",children:"iTLB multihit"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.code,{children:"nx_huge_pages=off"})}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"kpti-can-be-disabled-with",children:"KPTI can be disabled with"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"nopti"})," (x86, PowerPC)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"kpti=0"})," (ARM64)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"tsx-async-abort",children:"TSX async abort"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"tsx_async_abort=off"})," (x86)"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"kvm-nx-huge-pages",children:"KVM NX huge pages"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"kvm.nx_huge_pages=off"})," (x86)"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"meta-parameter-mitigations",children:"meta-parameter, mitigations"}),"\n",(0,r.jsx)(i.p,{children:"It was introduced in 5.2 and back-ported to 5.1.2, 5.0.16, and 4.19.43 (and perhaps others). It can be used to control all mitigations, on all architectures, as follows:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"mitigations=off"})," will disable all optional CPU mitigations;"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"mitigations=auto"})," (the default setting) will mitigate all known CPU vulnerabilities, but leave SMT enabled (if it is already);"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"mitigations=auto,nosmt"})," will mitigate all known CPU vulnerabilities and disable SMT if appropriate."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"sample-ryzen-3000-series",children:"Sample Ryzen 3000 series"}),"\n",(0,r.jsx)(i.h3,{id:"edit-grub-cmdline",children:"Edit grub CMDLINE"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:'$ cat /etc/default/grub|grep CMD\nGRUB_CMDLINE_LINUX_DEFAULT="quiet splash nospectre_v1 nospectre_v2 spectre_v2_user=off"\nGRUB_CMDLINE_LINUX=""\n'})}),"\n",(0,r.jsx)(i.h3,{id:"update-grub-and-restart",children:"Update grub and restart"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# update-grub\n# reboot\n# lscpu|grep Vul\nVulnerability Itlb multihit:         Not affected\nVulnerability L1tf:                  Not affected\nVulnerability Mds:                   Not affected\nVulnerability Meltdown:              Not affected\nVulnerability Spec store bypass:     Mitigation; Speculative Store Bypass disabled via prctl and seccomp\nVulnerability Spectre v1:            Vulnerable: __user pointer sanitization and usercopy barriers only; no swapgs barriers\nVulnerability Spectre v2:            Vulnerable, IBPB: disabled, STIBP: disabled\nVulnerability Srbds:                 Not affected\nVulnerability Tsx async abort:       Not affected\n"})}),"\n",(0,r.jsx)(i.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://unix.stackexchange.com/questions/554908/disable-spectre-and-meltdown-mitigations",children:"https://unix.stackexchange.com/questions/554908/disable-spectre-and-meltdown-mitigations"})}),"\n"]})]})}function u(e={}){let{wrapper:i}={...(0,l.a)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},50065:function(e,i,n){n.d(i,{Z:function(){return a},a:function(){return s}});var t=n(67294);let r={},l=t.createContext(r);function s(e){let i=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(l.Provider,{value:i},e.children)}}}]);