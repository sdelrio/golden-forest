"use strict";(self.webpackChunkgolden_forest_website=self.webpackChunkgolden_forest_website||[]).push([[2733],{69552:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var i=t(87462),a=(t(67294),t(3905));t(61839);const l={title:"Installing NixOS",date:20231014,author:"sdelrio",tags:["nixos","nix","nixos-install"]},s="Installing",o={unversionedId:"OS/GNU-Linux/NixOS/install-system",id:"OS/GNU-Linux/NixOS/install-system",title:"Installing NixOS",description:"The pretty basic install will need a configuration.nix, additionally the default installation also includes a hardware-configuration.nix.",source:"@site/docs/OS/GNU-Linux/NixOS/install-system.md",sourceDirName:"OS/GNU-Linux/NixOS",slug:"/OS/GNU-Linux/NixOS/install-system",permalink:"/docs/OS/GNU-Linux/NixOS/install-system",draft:!1,editUrl:"https://github.com/sdelrio/golden-forest/edit/master/docs/OS/GNU-Linux/NixOS/install-system.md",tags:[{label:"nixos",permalink:"/docs/tags/nixos"},{label:"nix",permalink:"/docs/tags/nix"},{label:"nixos-install",permalink:"/docs/tags/nixos-install"}],version:"current",frontMatter:{title:"Installing NixOS",date:20231014,author:"sdelrio",tags:["nixos","nix","nixos-install"]},sidebar:"tutorialSidebar",previous:{title:"NixOS Flakes",permalink:"/docs/OS/GNU-Linux/NixOS/flakes"},next:{title:"NixOS root on ZFS",permalink:"/docs/OS/GNU-Linux/NixOS/install-zfs"}},r={},d=[{value:"NixOS switch",id:"nixos-switch",level:2},{value:"Generations",id:"generations",level:2},{value:"Revert generation",id:"revert-generation",level:3},{value:"List generations",id:"list-generations",level:3},{value:"Delete generations",id:"delete-generations",level:3},{value:"Upgrade NixOs packages",id:"upgrade-nixos-packages",level:2},{value:"Hardware",id:"hardware",level:2},{value:"Show hardware configs",id:"show-hardware-configs",level:3},{value:"Hardware profiles",id:"hardware-profiles",level:3}],u={toc:d},c="wrapper";function p(e){let{components:n,...t}=e;return(0,a.kt)(c,(0,i.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"installing"},"Installing"),(0,a.kt)("p",null,"The pretty basic install will need a ",(0,a.kt)("inlineCode",{parentName:"p"},"configuration.nix"),", additionally the default installation also includes a ",(0,a.kt)("inlineCode",{parentName:"p"},"hardware-configuration.nix"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://nixos.org/manual/nixos/stable/#sec-installation-manual-installing"},"https://nixos.org/manual/nixos/stable/#sec-installation-manual-installing"))),(0,a.kt)("p",null,"The command ",(0,a.kt)("inlineCode",{parentName:"p"},"nixos-generate-config")," can generate those initial configuration\nfiles for you. Usually we will mount the target hardisk in some directory, in\nthis sample will be on ",(0,a.kt)("inlineCode",{parentName:"p"},"/mnt")," so the tool will write the files into ",(0,a.kt)("inlineCode",{parentName:"p"},"/mnt/etc/nixos"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nixos-generate-config --root /mnt\nwriting /mnt/etc/nixos/hardware-configuration.nix...\nwriting /mnt/etc/nixos/configuration.nix...\nFor more hardware-specific settings, see https://github.com/nixOs/nixos-hardware.\n")),(0,a.kt)("p",null,"At this point we can edit the file and take a look or even add something (",(0,a.kt)("inlineCode",{parentName:"p"},"vi /mnt/etc/nixos/configuration.nix"),").\n",(0,a.kt)("inlineCode",{parentName:"p"},"Once we have the"),"configuration.nix",(0,a.kt)("inlineCode",{parentName:"p"},"we can use the command"),"nixos-install`"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nixos-install\ncopying channel...\nbuilding the configuration in /mnt/etc/nixos/configuration.nix...\ncopying path '/nix/store/(...)' from 'https://cache.nix.org'...\ncopying path '/nix/store/(...)' to 'local'...\n(..)\n")),(0,a.kt)("p",null,"This command should include the grub install so after it finish we can reboot the system."),(0,a.kt)("h2",{id:"nixos-switch"},"NixOS switch"),(0,a.kt)("p",null,"Once the system is started we can change the ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/nixos/configuration.nix"),", after\nthat we can apply the change siwth the ",(0,a.kt)("inlineCode",{parentName:"p"},"nixos-rebuild swith")," or we can test it\nbefore applying it with the ",(0,a.kt)("inlineCode",{parentName:"p"},"nixos-rebuild test"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nixos-rebuild switch\nsudo nixos-rebuild test\n")),(0,a.kt)("h2",{id:"generations"},"Generations"),(0,a.kt)("p",null,"Every time the system state is rebuilt using ",(0,a.kt)("inlineCode",{parentName:"p"},"nixos-rebuild switch"),", a new generation\nis created. The previous generations are usually added to the grub menu in case you\nneed to go back"),(0,a.kt)("h3",{id:"revert-generation"},"Revert generation"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Roll back a user environment")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"nix-env --rollback\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Roll back a system environment")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"nixos-rebuild switch --rollback\n")),(0,a.kt)("h3",{id:"list-generations"},"List generations"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nix-env --list-generations --profile /nix/var/nix/profiles/system\n")),(0,a.kt)("h3",{id:"delete-generations"},"Delete generations"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nix profile wipe-history --profile /nix/var/nix/profiles/system --older-than 14d\n")),(0,a.kt)("h2",{id:"upgrade-nixos-packages"},"Upgrade NixOs packages"),(0,a.kt)("p",null,"Will be the classic equivalent of ",(0,a.kt)("inlineCode",{parentName:"p"},"apt-get upgrade")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"yum check-update"),". It will\nget all the packages and upgrade to the latest verions."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nixos-rebuild switch --upgrade\n")),(0,a.kt)("h2",{id:"hardware"},"Hardware"),(0,a.kt)("h3",{id:"show-hardware-configs"},"Show hardware configs"),(0,a.kt)("p",null,"It can be usefull if we add or change some hardware which can be detected by the basic configurator."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"nixos-generate-config --show-hardware-config \n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"nixos-generate-config --show-hardware-config --no-filesystems\n")),(0,a.kt)("h3",{id:"hardware-profiles"},"Hardware profiles"),(0,a.kt)("p",null,"Some notebooks and other systems hardware configurations from the official NixOS github:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/NixOS/nixos-hardware"},"https://github.com/NixOS/nixos-hardware"))))}p.isMDXComponent=!0}}]);