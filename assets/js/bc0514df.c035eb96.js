"use strict";(self.webpackChunkgolden_forest_website=self.webpackChunkgolden_forest_website||[]).push([[3997],{77154:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(87462),l=(a(67294),a(3905));a(61839);const o={title:"TrueNAS SCALE Install",date:20230901,author:"sdelrio",tags:["zfs","zpool","nas"]},r="TrueNAS SCALE Install",s={unversionedId:"OS/GNU-Linux/TrueNAS/truenas-install",id:"OS/GNU-Linux/TrueNAS/truenas-install",title:"TrueNAS SCALE Install",description:"By default Truenas will install in one (or several disk if want to mirror) using all space available on the disk, without posibility for partition.",source:"@site/docs/OS/GNU-Linux/TrueNAS/truenas-install.md",sourceDirName:"OS/GNU-Linux/TrueNAS",slug:"/OS/GNU-Linux/TrueNAS/truenas-install",permalink:"/docs/OS/GNU-Linux/TrueNAS/truenas-install",draft:!1,editUrl:"https://github.com/sdelrio/golden-forest/edit/master/docs/OS/GNU-Linux/TrueNAS/truenas-install.md",tags:[{label:"zfs",permalink:"/docs/tags/zfs"},{label:"zpool",permalink:"/docs/tags/zpool"},{label:"nas",permalink:"/docs/tags/nas"}],version:"current",frontMatter:{title:"TrueNAS SCALE Install",date:20230901,author:"sdelrio",tags:["zfs","zpool","nas"]},sidebar:"tutorialSidebar",previous:{title:"TrueNAS",permalink:"/docs/OS/GNU-Linux/TrueNAS/"},next:{title:"TrueNAS SCALE scripts",permalink:"/docs/OS/GNU-Linux/TrueNAS/truenas-scripts"}},i={},p=[{value:"Using a smaller partition for the root pool",id:"using-a-smaller-partition-for-the-root-pool",level:2},{value:"Use the free space to create a ZVOL",id:"use-the-free-space-to-create-a-zvol",level:3},{value:"References",id:"references",level:3}],u={toc:p},d="wrapper";function m(e){let{components:t,...a}=e;return(0,l.kt)(d,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"truenas-scale-install"},"TrueNAS SCALE Install"),(0,l.kt)("p",null,"By default Truenas will install in one (or several disk if want to mirror) using all space available on the disk, without posibility for partition."),(0,l.kt)("h2",{id:"using-a-smaller-partition-for-the-root-pool"},"Using a smaller partition for the root pool"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Install on a small temporary disk (sda in this case)."),(0,l.kt)("li",{parentName:"ul"},"Copy partitions from temporary disk to target disk (nvme2n1 in this case):")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sgdisk --backup=/root/partition_table_sda /dev/sda\nsgdisk --load-backup=/root/partition_table_sda /dev/nvme2n1\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Then Reboot the system through the UI or by CLI")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"reboot\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Attach target disk parition to temporary install disk partition, as if you were preparing a mirror")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"zpool attach boot-pool sda3 nvme2n1p3\nzpool status boot-pool\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Wait for resilver"),(0,l.kt)("li",{parentName:"ul"},"Copy the content of the grub and UEFI partitions")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"dd if=/dev/sda1 of=/dev/nvme2n1p1\ndd if=/dev/sda2 of=/dev/nvme2n1p2\nsync\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Detach temporary install disk (sda in this example)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"zpool offline boot-pool sda\nzpool detach boot-pool sda\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"root@truenas[~]# zpool status boot-pool\n\n  pool: boot-pool\n state: ONLINE\nstatus: Some supported and requested features are not enabled on the pool.\n    The pool can still be used, but some features are unavailable.\naction: Enable all features using 'zpool upgrade'. Once this is done,\n    the pool may no longer be accessible by software that does not support\n    the features. See zpool-features(7) for details.\n  scan: scrub repaired 0B in 00:00:04 with 0 errors on Tue Aug 29 03:45:05 2023\nconfig:\n\n    NAME         STATE     READ WRITE CKSUM\n    boot-pool    ONLINE       0     0     0\n      nvme2n1p3  ONLINE       0     0     0\n\nerrors: No known data errors\n")),(0,l.kt)("h3",{id:"use-the-free-space-to-create-a-zvol"},"Use the free space to create a ZVOL"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Check partition with ",(0,l.kt)("inlineCode",{parentName:"li"},"parted"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"(parted) print free                                                       \nModel: Samsung SSD 980 500GB (nvme)\nDisk /dev/nvme2n1: 500GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name  Flags\n        17.4kB  2097kB  2080kB  Free Space\n 1      2097kB  3146kB  1049kB                     bios_grub, legacy_boot\n 2      3146kB  540MB   537MB   fat32              boot, esp\n 3      540MB   40.0GB  39.5GB  zfs\n        40.0GB  500GB   460GB   Free Space\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Make new partition. You could use 100% but I like this unit to last a little longer so I leave a 5% free space. So I end partition at 470GB insteadl 500GB.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"(parted) mkpart                                                           \nPartition name?  []?                                                      \nFile system type?  [ext2]? zfs                                            \nStart? 40.0GB                                                             \nEnd? 470GB                                                                \n(parted) p                                                                \nModel: Samsung SSD 980 500GB (nvme)\nDisk /dev/nvme2n1: 500GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name  Flags\n 1      2097kB  3146kB  1049kB                     bios_grub, legacy_boot\n 2      3146kB  540MB   537MB   fat32              boot, esp\n 3      540MB   40.0GB  39.5GB  zfs\n 4      40.0GB  470GB   430GB   zfs\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Create a zpool with extra space")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"zpool create boot-extra  /dev/disk/by-id/nvme-Samsung_SSD_980_500GB_S64AAA0T012345B-part4\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Export the poool so TrueNAS can import it")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"zpool export boot-extra\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"In TrueNAS UI ",(0,l.kt)("inlineCode",{parentName:"li"},"Storage")," -> ",(0,l.kt)("inlineCode",{parentName:"li"},"Import Pool")," -> select pool to import pool: ",(0,l.kt)("inlineCode",{parentName:"li"},"boot-extra"))),(0,l.kt)("h3",{id:"references"},"References"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://www.truenas.com/community/threads/howto-setup-a-pair-of-larger-ssds-for-boot-pool-and-data.81409/"},"https://www.truenas.com/community/threads/howto-setup-a-pair-of-larger-ssds-for-boot-pool-and-data.81409/"))))}m.isMDXComponent=!0}}]);